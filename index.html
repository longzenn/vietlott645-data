<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Dự đoán Vietlott 6/45 từ CSV</title>
  <link rel="shortcut icon" href="https://vietlott.vn/favicon.ico" type="image/png">
  <style>
    body { font-family: sans-serif; text-align: center; background: #f9f9f9; padding: 20px; }
    h1 { margin-bottom: 10px; }
    input, select, button { margin: 5px; padding: 5px; }
    .numbers { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
    .ball { width: 40px; height: 40px; background: gold; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Dự đoán Vietlott 6/45</h1>

  <div>
    <label>Chiến lược:</label>
    <select id="strategy">
      <option value="hot-heavy">Hot-heavy</option>
      <option value="balanced">Balanced</option>
      <option value="only-hot">Only Hot</option>
    </select>
    <input type="date" id="today">
    <button id="predictBtn">Dự đoán</button>
  </div>

  <h3>Hot Numbers:</h3>
  <p id="hotNumbers">Đang tải...</p>

  <h3>Cold Numbers:</h3>
  <p id="coldNumbers">Đang tải...</p>

  <div id="prediction"></div>

  <script>
    let hot = [], cold = [];

    // ==== Fetch CSV từ GitHub ====
    const csvUrl = "https://raw.githubusercontent.com/longzenn/vietlott645-data/main/static/mega645.csv";

    fetch(csvUrl)
      .then(r => r.text())
      .then(text => {
        const data = parseCSV(text);
        calcStats(data);
      })
      .catch(err => {
        document.getElementById("hotNumbers").innerText = "Lỗi tải CSV!";
        document.getElementById("coldNumbers").innerText = "Lỗi tải CSV!";
        console.error(err);
      });

    function mulberry32(a) {
      return function () {
        let t = a += 0x6d2b79f5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }
    }

    function seededRngFromSeed(str) {
      let seed = 0;
      for (let i = 0; i < str.length; i++) {
        seed = (seed << 5) - seed + str.charCodeAt(i);
        seed |= 0;
      }
      return mulberry32(seed);
    }

    function pick(arr, count, rng) {
      const res = new Set();
      while (res.size < count) {
        const idx = Math.floor(rng() * arr.length);
        res.add(arr[idx]);
      }
      return Array.from(res);
    }

    function predictStat(today, strategy, hot, cold) {
      const mid = Array.from({ length: 45 }, (_, i) => i + 1)
        .filter(n => !hot.includes(n) && !cold.includes(n));
      const rng = seededRngFromSeed(`stat|${today}|${strategy}`);
      let nums = [];
      if (strategy === "hot-heavy") {
        nums = [...pick(hot, 4, rng), ...pick(mid, 1, rng), ...pick(cold, 1, rng)];
      } else if (strategy === "balanced") {
        nums = [...pick(hot, 2, rng), ...pick(mid, 2, rng), ...pick(cold, 2, rng)];
      } else {
        nums = pick(hot, 6, rng);
      }
      return nums.sort((a, b) => a - b);
    }

    function parseCSV(text) {
      const rows = text.trim().split("\n").map(r => r.split(","));
      rows.shift(); // bỏ tiêu đề
      return rows.map(r => r.slice(1).map(Number)); // chỉ lấy Num1..Num6
    }

    function calcStats(data) {
      const freq = Array(46).fill(0);
      data.forEach(draw => {
        draw.forEach(num => { if (!isNaN(num)) freq[num]++; });
      });
      const sorted = [...Array(45).keys()].map(i => i + 1).sort((a, b) => freq[b] - freq[a]);
      hot = sorted.slice(0, 10);
      cold = sorted.slice(-10);
      document.getElementById("hotNumbers").innerText = hot.join(", ");
      document.getElementById("coldNumbers").innerText = cold.join(", ");
    }

    document.getElementById("today").value = new Date().toISOString().split("T")[0];

    document.getElementById("predictBtn").addEventListener("click", () => {
      if (!hot.length || !cold.length) {
        alert("Chưa có dữ liệu thống kê!");
        return;
      }
      const strategy = document.getElementById("strategy").value;
      const today = document.getElementById("today").value;
      const nums = predictStat(today, strategy, hot, cold);
      document.getElementById("prediction").innerHTML = `<h3>Dãy dự đoán:</h3>
        <div class="numbers">${nums.map(n => `<div class="ball">${n}</div>`).join("")}</div>`;
    });
  </script>
</body>
</html>
