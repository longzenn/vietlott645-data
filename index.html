<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Dá»± Ä‘oÃ¡n Vietlott 6/45</title>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <link rel="shortcut icon" href="https://vietlott.vn/favicon.ico" type="image/png">
  <link href="static/styles.css" rel="stylesheet" type="text/css"  media="all"  />
</head>
<body>
  <header>
    <h1>Dá»± Ä‘oÃ¡n Vietlott 6/45</h1>
  </header>

  <div class="container">
    <div class="form-group">
      <label for="strategy">Chiáº¿n lÆ°á»£c:</label>
      <select id="strategy">
        <option value="hot-heavy">Hot-heavy</option>
        <option value="balanced">Balanced</option>
        <option value="only-hot">Only Hot</option>
      </select>

      <input type="date" id="today">
      <button id="predictBtn">ğŸ² Dá»± Ä‘oÃ¡n</button>
    </div>

    <h3>Hot Numbers ğŸ”¥:</h3>
    <p id="hotNumbers">Äang táº£i...</p>

    <h3>Cold Numbers â„ï¸:</h3>
    <p id="coldNumbers">Äang táº£i...</p>

    <div id="prediction"></div>
  </div>

  <footer>
    Â© 2025 - CÃ´ng cá»¥ dá»± Ä‘oÃ¡n Vietlott 6/45 ğŸ˜
  </footer>

  <script>
    let hot = [], cold = [];

    // ==== Fetch CSV tá»« GitHub ====
    const csvUrl = "https://raw.githubusercontent.com/longzenn/vietlott645-data/main/static/mega645.csv";

    fetch(csvUrl)
      .then(r => r.text())
      .then(text => {
        const data = parseCSV(text);
        calcStats(data);
      })
      .catch(err => {
        document.getElementById("hotNumbers").innerText = "âš ï¸ Lá»—i táº£i CSV!";
        document.getElementById("coldNumbers").innerText = "âš ï¸ Lá»—i táº£i CSV!";
        console.error(err);
      });

    function mulberry32(a) {
      return function () {
        let t = a += 0x6d2b79f5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }
    }

    function seededRngFromSeed(str) {
      let seed = 0;
      for (let i = 0; i < str.length; i++) {
        seed = (seed << 5) - seed + str.charCodeAt(i);
        seed |= 0;
      }
      return mulberry32(seed);
    }

    function pick(arr, count, rng) {
      const res = new Set();
      while (res.size < count) {
        const idx = Math.floor(rng() * arr.length);
        res.add(arr[idx]);
      }
      return Array.from(res);
    }

    function predictStat(today, strategy, hot, cold) {
      const mid = Array.from({ length: 45 }, (_, i) => i + 1)
        .filter(n => !hot.includes(n) && !cold.includes(n));
      const rng = seededRngFromSeed(`stat|${today}|${strategy}`);
      let nums = [];
      if (strategy === "hot-heavy") {
        nums = [...pick(hot, 4, rng), ...pick(mid, 1, rng), ...pick(cold, 1, rng)];
      } else if (strategy === "balanced") {
        nums = [...pick(hot, 2, rng), ...pick(mid, 2, rng), ...pick(cold, 2, rng)];
      } else {
        nums = pick(hot, 6, rng);
      }
      return nums.sort((a, b) => a - b);
    }

    function parseCSV(text) {
      const rows = text.trim().split("\n").map(r => r.split(","));
      rows.shift(); // bá» tiÃªu Ä‘á»
      return rows.map(r => r.slice(1).map(Number)); // chá»‰ láº¥y Num1..Num6
    }

    function calcStats(data) {
      const freq = Array(46).fill(0);
      data.forEach(draw => {
        draw.forEach(num => { if (!isNaN(num)) freq[num]++; });
      });
      const sorted = [...Array(45).keys()].map(i => i + 1).sort((a, b) => freq[b] - freq[a]);
      hot = sorted.slice(0, 10);
      cold = sorted.slice(-10);
      document.getElementById("hotNumbers").innerText = hot.join(", ");
      document.getElementById("coldNumbers").innerText = cold.join(", ");
    }

    document.getElementById("today").value = new Date().toISOString().split("T")[0];

    document.getElementById("predictBtn").addEventListener("click", () => {
      if (!hot.length || !cold.length) {
        alert("âš ï¸ ChÆ°a cÃ³ dá»¯ liá»‡u thá»‘ng kÃª!");
        return;
      }
      const strategy = document.getElementById("strategy").value;
      const today = document.getElementById("today").value;
      const nums = predictStat(today, strategy, hot, cold);
      document.getElementById("prediction").innerHTML = `<h3>DÃ£y dá»± Ä‘oÃ¡n ğŸ¯:</h3>
        <div class="numbers">${nums.map(n => `<div class="ball">${n}</div>`).join("")}</div>`;
    });
  </script>
</body>
</html>
