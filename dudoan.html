<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Vietlott 6/45 - AI Prediction System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--fontStack-sansSerif, -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji");
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .file-upload {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .file-upload h2 {
            margin-bottom: 20px;
            color: #5a67d8;
        }

        .upload-area {
            border: 3px dashed #5a67d8;
            border-radius: 10px;
            padding: 40px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            background-color: #f7fafc;
            border-color: #4c51bf;
        }

        .upload-area.dragover {
            background-color: #ebf4ff;
            border-color: #3182ce;
        }

        input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #5a67d8, #4c51bf);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            color: #5a67d8;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prediction-section {
            background: linear-gradient(135deg, #66cc66, #33cc00);
            color: white;
        }

        .prediction-section h3 {
            color: white;
        }

        .number-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .number-ball {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            color: white;
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .hot-cold-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .number-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .mini-ball {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            color: white;
        }

        .hot { background: linear-gradient(135deg, #ff6b6b, #ee5a52); }
        .cold { background: linear-gradient(135deg, #4ecdc4, #44a08d); }
        .frequent { background: linear-gradient(135deg, #feca57, #ff9ff3); }

        .chart-container {
            margin: 20px 0;
            height: 300px;
            position: relative;
        }

        .frequency-bar {
            display: flex;
			flex-wrap: wrap;
            align-items: end;
            height: 200px;
            padding: 20px 0;
			gap: 40px 0;
        }

        .bar {
            background: linear-gradient(135deg, #5a67d8, #4c51bf);
            border-radius: 4px 4px 0 0;
            min-width: 12px;
            margin: 0 2px;
            position: relative;
        }

        .bar-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            color: #666;
        }

        .generate-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
            width: 100%;
            margin-top: 20px;
        }

        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255,107,107,0.6);
        }

        .pattern-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .pattern-item {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .pattern-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #5a67d8;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Vietlott 6/45 AI Prediction</h1>
            <p>H·ªá th·ªëng d·ª± ƒëo√°n th√¥ng minh v·ªõi ph√¢n t√≠ch d·ªØ li·ªáu chuy√™n s√¢u</p>
        </div>

        <div class="file-upload">
            <h2>üìä T·∫£i d·ªØ li·ªáu CSV</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <button class="upload-btn" onclick="loadDefaultCSV()" style="background: linear-gradient(135deg, #4ecdc4, #44a08d);">
                    üîÑ T·ª± ƒë·ªông load t·ª´ static/mega645.csv
                </button>
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    üìÅ Ch·ªçn file CSV kh√°c
                </button>
            </div>
            <div class="upload-area" id="uploadArea">
                <div>
                    <h3>üóÇÔ∏è Ho·∫∑c k√©o th·∫£ file CSV v√†o ƒë√¢y</h3>
                    <p>File CSV c·∫ßn c√≥ c·∫•u tr√∫c: date, num1, num2, num3, num4, num5, num6</p>
                </div>
            </div>
            <input type="file" id="fileInput" accept=".csv" />
            <div id="fileStatus"></div>
        </div>

        <div id="analysisResults" class="hidden">
            <div class="stats-grid">
                <!-- D·ª± ƒëo√°n ch√≠nh -->
                <div class="card prediction-section">
                    <h3>üéØ D·ª± ƒëo√°n cho k·ª≥ ti·∫øp theo</h3>
                    <div class="number-grid" id="predictedNumbers"></div>
                    <button class="generate-btn" onclick="generateNewPrediction()">
                        <span class="loading hidden" style="display: none;">üîÑ</span> T·∫°o d·ª± ƒëo√°n m·ªõi
                    </button>
                </div>

                <!-- Th·ªëng k√™ t·ªïng quan -->
                <div class="card">
                    <h3>üìà Th·ªëng k√™ t·ªïng quan</h3>
                    <div id="overallStats"></div>
                </div>

                <!-- S·ªë n√≥ng/l·∫°nh -->
                <div class="card">
                    <h3>üî•‚ùÑÔ∏è Ph√¢n t√≠ch N√≥ng/L·∫°nh (To√†n th·ªùi gian)</h3>
                    <div class="hot-cold-grid">
                        <div>
                            <h4 style="color: #ff6b6b; margin-bottom: 10px;">üî• Top 10 s·ªë n√≥ng nh·∫•t</h4>
                            <div class="number-list" id="hotNumbers"></div>
                        </div>
                        <div>
                            <h4 style="color: #4ecdc4; margin-bottom: 10px;">‚ùÑÔ∏è Top 10 s·ªë l·∫°nh nh·∫•t</h4>
                            <div class="number-list" id="coldNumbers"></div>
                        </div>
                    </div>
                </div>

                <!-- Ph√¢n t√≠ch pattern -->
                <div class="card">
                    <h3>üîç Ph√¢n t√≠ch Pattern</h3>
                    <div class="pattern-analysis" id="patternAnalysis"></div>
                </div>

                <!-- Bi·ªÉu ƒë·ªì t·∫ßn su·∫•t -->
                <div class="card">
                    <h3>üìä T·∫ßn su·∫•t xu·∫•t hi·ªán</h3>
                    <div class="chart-container">
                        <div class="frequency-bar" id="frequencyChart"></div>
                    </div>
                </div>

                <!-- Xu h∆∞·ªõng s·ªë -->
                <div class="card">
                    <h3>üìà Xu h∆∞·ªõng & D·ª± ƒëo√°n kh√°c</h3>
                    <div id="trendAnalysis"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let lotteryData = [];
        let predictions = [];
        
        // Kh·ªüi t·∫°o s·ª± ki·ªán
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        setupDragAndDrop();
        
        // Auto-load file m·∫∑c ƒë·ªãnh khi trang ƒë∆∞·ª£c t·∫£i
        window.addEventListener('load', () => {
            // Th·ª≠ load file m·∫∑c ƒë·ªãnh sau 500ms
            setTimeout(() => {
                if (lotteryData.length === 0) {
                    loadDefaultCSV();
                }
            }, 500);
        });

        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    processFile(files[0]);
                }
            });
        }

        function loadDefaultCSV() {
            const status = document.getElementById('fileStatus');
            status.innerHTML = '<p style="color: #4ecdc4;">üîÑ ƒêang t·∫£i file static/mega645.csv...</p>';
            
            fetch('static/mega645.csv')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(csvData => {
                    lotteryData = parseCSV(csvData);
                    
                    if (lotteryData.length > 0) {
                        status.innerHTML = `<p style="color: green;">‚úÖ ƒê√£ t·∫£i ${lotteryData.length} k·∫øt qu·∫£ t·ª´ static/mega645.csv!</p>`;
                        analyzeData();
                        document.getElementById('analysisResults').classList.remove('hidden');
                    } else {
                        status.innerHTML = '<p style="color: red;">‚ùå File t·ªìn t·∫°i nh∆∞ng kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá</p>';
                    }
                })
                .catch(error => {
                    console.log('Kh√¥ng th·ªÉ t·∫£i file m·∫∑c ƒë·ªãnh:', error);
                    status.innerHTML = `
                        <div style="color: #ff9500; background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ff9500;">
                            <p><strong>‚ö†Ô∏è Kh√¥ng t√¨m th·∫•y file static/mega645.csv</strong></p>
                            <p>Vui l√≤ng:</p>
                            <ul style="text-align: left; margin: 10px 0;">
                                <li>1. Ch·∫°y <code>python crawler.py</code> ƒë·ªÉ t·∫°o d·ªØ li·ªáu</li>
                                <li>2. ƒê·∫£m b·∫£o file <code>mega645.csv</code> n·∫±m trong folder <code>static/</code></li>
                                <li>3. Ho·∫∑c upload file CSV th·ªß c√¥ng</li>
                            </ul>
                        </div>
                    `;
                });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        function processFile(file) {
            const status = document.getElementById('fileStatus');
            status.innerHTML = '<p>‚è≥ ƒêang x·ª≠ l√Ω file...</p>';

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    lotteryData = parseCSV(csv);
                    
                    if (lotteryData.length > 0) {
                        status.innerHTML = `<p style="color: green;">‚úÖ ƒê√£ t·∫£i ${lotteryData.length} k·∫øt qu·∫£ th√†nh c√¥ng!</p>`;
                        analyzeData();
                        document.getElementById('analysisResults').classList.remove('hidden');
                    } else {
                        status.innerHTML = '<p style="color: red;">‚ùå Kh√¥ng th·ªÉ ƒë·ªçc d·ªØ li·ªáu t·ª´ file CSV</p>';
                    }
                } catch (error) {
                    status.innerHTML = '<p style="color: red;">‚ùå L·ªói khi x·ª≠ l√Ω file: ' + error.message + '</p>';
                }
            };
            reader.readAsText(file);
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const data = [];
            
            for (let i = 1; i < lines.length; i++) { // B·ªè qua header
                const cols = lines[i].split(',');
                if (cols.length >= 7) {
                    const numbers = [
                        parseInt(cols[1]), parseInt(cols[2]), parseInt(cols[3]),
                        parseInt(cols[4]), parseInt(cols[5]), parseInt(cols[6])
                    ].filter(n => n >= 1 && n <= 45).sort((a, b) => a - b);
                    
                    if (numbers.length === 6) {
                        data.push({
                            date: cols[0],
                            numbers: numbers
                        });
                    }
                }
            }
            
            return data;
        }

        function analyzeData() {
            generatePredictions();
            displayOverallStats();
            displayHotColdNumbers();
            displayPatternAnalysis();
            displayFrequencyChart();
            displayTrendAnalysis();
        }

        function generatePredictions() {
            if (lotteryData.length === 0) {
                console.log('‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫°o d·ª± ƒëo√°n');
                return;
            }
            
            console.log('üéØ ƒêang t·∫°o d·ª± ƒëo√°n v·ªõi', lotteryData.length, 'k·∫øt qu·∫£...');
            
            // Thu·∫≠t to√°n d·ª± ƒëo√°n k·∫øt h·ª£p nhi·ªÅu ph∆∞∆°ng ph√°p
            const methods = [
                predictByFrequency(),
                predictByTrend(),
                predictByPattern(),
                predictByGaps(),
                predictByMachine()
            ];
            
            // T√≠nh ƒëi·ªÉm tr·ªçng s·ªë cho t·ª´ng s·ªë
            const scores = {};
            for (let i = 1; i <= 45; i++) {
                scores[i] = 0;
            }
            
            methods.forEach((method, index) => {
                const weight = [0.3, 0.25, 0.2, 0.15, 0.1][index];
                if (method && method.length > 0) {
                    method.forEach((num, pos) => {
                        if (num >= 1 && num <= 45) {
                            scores[num] += weight * (6 - pos);
                        }
                    });
                }
            });
            
            // Ch·ªçn 6 s·ªë v·ªõi gi·∫£m thi·ªÉu consecutive
            const finalPrediction = selectOptimalNumbers(scores);
            
            predictions = [finalPrediction, ...methods];
            displayPrediction(finalPrediction);
            
            console.log('‚úÖ D·ª± ƒëo√°n m·ªõi:', finalPrediction);
        }

        function selectOptimalNumbers(scores) {
            // S·∫Øp x·∫øp theo ƒëi·ªÉm s·ªë
            const sortedNumbers = Object.entries(scores)
                .map(([num, score]) => ({num: parseInt(num), score}))
                .sort((a, b) => b.score - a.score);
            
            const selected = [];
            const candidates = [...sortedNumbers];
            
            // Ch·ªçn s·ªë ƒë·∫ßu ti√™n (ƒëi·ªÉm cao nh·∫•t)
            selected.push(candidates[0].num);
            
            // Ch·ªçn 5 s·ªë c√≤n l·∫°i v·ªõi ƒëi·ªÅu ki·ªán tr√°nh qu√° nhi·ªÅu consecutive
            for (let i = 0; i < 5; i++) {
                let bestCandidate = null;
                let bestIndex = -1;
                
                for (let j = 1; j < candidates.length; j++) {
                    const candidate = candidates[j].num;
                    
                    // Ki·ªÉm tra consecutive penalty
                    const consecutiveCount = countConsecutive([...selected, candidate]);
                    const maxConsecutive = Math.min(2, Math.floor(selected.length * 0.4)); // T·ªëi ƒëa 2 c·∫∑p consecutive
                    
                    // Ki·ªÉm tra kho·∫£ng c√°ch t·ªëi thi·ªÉu
                    const hasGoodSpacing = checkSpacing([...selected, candidate]);
                    
                    if (consecutiveCount <= maxConsecutive && hasGoodSpacing) {
                        bestCandidate = candidate;
                        bestIndex = j;
                        break;
                    }
                }
                
                // N·∫øu kh√¥ng t√¨m ƒë∆∞·ª£c s·ªë ph√π h·ª£p, ch·ªçn s·ªë t·ªët nh·∫•t c√≥ th·ªÉ
                if (bestCandidate === null) {
                    for (let j = 1; j < Math.min(20, candidates.length); j++) {
                        const candidate = candidates[j].num;
                        if (!selected.includes(candidate)) {
                            bestCandidate = candidate;
                            bestIndex = j;
                            break;
                        }
                    }
                }
                
                if (bestCandidate !== null) {
                    selected.push(bestCandidate);
                    candidates.splice(bestIndex, 1);
                }
            }
            
            return selected.sort((a, b) => a - b);
        }
        
        function countConsecutive(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            let consecutiveCount = 0;
            
            for (let i = 0; i < sorted.length - 1; i++) {
                if (sorted[i + 1] === sorted[i] + 1) {
                    consecutiveCount++;
                }
            }
            
            return consecutiveCount;
        }
        
        function checkSpacing(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            
            // Ki·ªÉm tra kh√¥ng c√≥ qu√° nhi·ªÅu s·ªë trong c√πng 1 range 10 s·ªë
            const ranges = [0, 0, 0, 0, 0]; // 1-9, 10-19, 20-29, 30-39, 40-45
            
            sorted.forEach(num => {
                const rangeIndex = Math.min(4, Math.floor((num - 1) / 10));
                ranges[rangeIndex]++;
            });
            
            // Kh√¥ng cho ph√©p qu√° 3 s·ªë trong c√πng 1 range
            return ranges.every(count => count <= 3);
        }

        function predictByFrequency() {
            // D·ª± ƒëo√°n d·ª±a tr√™n t·∫ßn su·∫•t xu·∫•t hi·ªán
            const frequency = {};
            for (let i = 1; i <= 45; i++) frequency[i] = 0;
            
            lotteryData.slice(0, 50).forEach(draw => { // 50 k·ª≥ g·∫ßn nh·∫•t
                draw.numbers.forEach(num => frequency[num]++);
            });
            
            return Object.entries(frequency)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6)
                .map(([num]) => parseInt(num));
        }

        function predictByTrend() {
            // D·ª± ƒëo√°n d·ª±a tr√™n xu h∆∞·ªõng tƒÉng/gi·∫£m
            const recent = lotteryData.slice(0, 20);
            const older = lotteryData.slice(20, 40);
            
            const recentFreq = {};
            const olderFreq = {};
            
            for (let i = 1; i <= 45; i++) {
                recentFreq[i] = 0;
                olderFreq[i] = 0;
            }
            
            recent.forEach(draw => draw.numbers.forEach(num => recentFreq[num]++));
            older.forEach(draw => draw.numbers.forEach(num => olderFreq[num]++));
            
            const trending = [];
            for (let i = 1; i <= 45; i++) {
                const trend = recentFreq[i] - olderFreq[i];
                trending.push({num: i, trend});
            }
            
            return trending.sort((a, b) => b.trend - a.trend)
                .slice(0, 6)
                .map(item => item.num);
        }

        function predictByPattern() {
            if (lotteryData.length === 0) return [];
            
            // D·ª± ƒëo√°n d·ª±a tr√™n pattern s·ªë ch·∫µn/l·∫ª, kho·∫£ng c√°ch
            const patterns = analyzePatterns();
            const predicted = [];
            
            // Ch·ªçn s·ªë theo pattern ph·ªï bi·∫øn
            const oddCount = Math.max(1, Math.min(5, Math.round(patterns.avgOddCount)));
            const evenCount = 6 - oddCount;
            
            // L·∫•y s·ªë l·∫ª v√† ch·∫µn c√≥ t·∫ßn su·∫•t cao
            const frequency = {};
            for (let i = 1; i <= 45; i++) frequency[i] = 0;
            
            lotteryData.slice(0, 50).forEach(draw => {
                draw.numbers.forEach(num => frequency[num]++);
            });
            
            const oddNumbers = [];
            const evenNumbers = [];
            
            for (let i = 1; i <= 45; i++) {
                if (i % 2 === 1) {
                    oddNumbers.push({num: i, freq: frequency[i]});
                } else {
                    evenNumbers.push({num: i, freq: frequency[i]});
                }
            }
            
            // S·∫Øp x·∫øp theo t·∫ßn su·∫•t v√† th√™m random
            oddNumbers.sort((a, b) => b.freq - a.freq + (Math.random() - 0.5) * 0.5);
            evenNumbers.sort((a, b) => b.freq - a.freq + (Math.random() - 0.5) * 0.5);
            
            predicted.push(...oddNumbers.slice(0, oddCount).map(item => item.num));
            predicted.push(...evenNumbers.slice(0, evenCount).map(item => item.num));
            
            return predicted.sort((a, b) => a - b);
        }

        function predictByGaps() {
            // D·ª± ƒëo√°n d·ª±a tr√™n kho·∫£ng c√°ch gi·ªØa c√°c l·∫ßn xu·∫•t hi·ªán
            const lastSeen = {};
            const gaps = {};
            
            lotteryData.forEach((draw, index) => {
                draw.numbers.forEach(num => {
                    if (lastSeen[num] !== undefined) {
                        if (!gaps[num]) gaps[num] = [];
                        gaps[num].push(index - lastSeen[num]);
                    }
                    lastSeen[num] = index;
                });
            });
            
            const predicted = [];
            Object.entries(lastSeen).forEach(([num, lastIndex]) => {
                const avgGap = gaps[num] ? gaps[num].reduce((a, b) => a + b, 0) / gaps[num].length : 10;
                const currentGap = lotteryData.length - lastIndex;
                
                if (currentGap >= avgGap * 0.8) {
                    predicted.push({num: parseInt(num), score: currentGap / avgGap});
                }
            });
            
            return predicted.sort((a, b) => b.score - a.score)
                .slice(0, 6)
                .map(item => item.num);
        }

        function predictByMachine() {
            if (lotteryData.length === 0) return [];
            
            // Thu·∫≠t to√°n "h·ªçc m√°y" v·ªõi ph√¢n b·ªë th·ª±c t·∫ø h∆°n
            const weights = {};
            const ranges = [
                {min: 1, max: 10, quota: 1},    // 1 s·ªë t·ª´ 1-10
                {min: 11, max: 20, quota: 2},   // 2 s·ªë t·ª´ 11-20  
                {min: 21, max: 30, quota: 2},   // 2 s·ªë t·ª´ 21-30
                {min: 31, max: 45, quota: 1}    // 1 s·ªë t·ª´ 31-45
            ];
            
            const selected = [];
            
            ranges.forEach(range => {
                const candidates = [];
                
                for (let i = range.min; i <= range.max; i++) {
                    let freq = 0;
                    lotteryData.slice(0, 50).forEach(draw => {
                        if (draw.numbers.includes(i)) freq++;
                    });
                    
                    // Tr·ªçng s·ªë k·∫øt h·ª£p frequency + random
                    const weight = freq + Math.random() * 10;
                    candidates.push({num: i, weight});
                }
                
                // Ch·ªçn s·ªë t·ªët nh·∫•t t·ª´ range n√†y
                candidates.sort((a, b) => b.weight - a.weight);
                for (let i = 0; i < Math.min(range.quota, candidates.length); i++) {
                    if (selected.length < 6) {
                        selected.push(candidates[i].num);
                    }
                }
            });
            
            // N·∫øu ch∆∞a ƒë·ªß 6 s·ªë, th√™m random
            while (selected.length < 6) {
                const randomNum = Math.floor(Math.random() * 45) + 1;
                if (!selected.includes(randomNum)) {
                    selected.push(randomNum);
                }
            }
            
            return selected.sort((a, b) => a - b);
        }

        function displayPrediction(numbers) {
            const container = document.getElementById('predictedNumbers');
            container.innerHTML = '';
            
            numbers.forEach((num, index) => {
                const ball = document.createElement('div');
                ball.className = 'number-ball';
                ball.textContent = num;
                ball.style.animationDelay = `${index * 0.2}s`;
                container.appendChild(ball);
            });
        }

        function displayOverallStats() {
            const container = document.getElementById('overallStats');
            
            const totalDraws = lotteryData.length;
            const dateRange = totalDraws > 0 ? `${lotteryData[lotteryData.length-1].date} - ${lotteryData[0].date}` : '';
            
            // T√≠nh c√°c th·ªëng k√™
            const allNumbers = lotteryData.flatMap(draw => draw.numbers);
            const avgSum = allNumbers.reduce((a, b) => a + b, 0) / allNumbers.length;
            
            const patterns = analyzePatterns();
            
            container.innerHTML = `
                <div class="pattern-analysis">
                    <div class="pattern-item">
                        <div class="pattern-value">${totalDraws}</div>
                        <div>T·ªïng s·ªë k·ª≥</div>
                    </div>
                    <div class="pattern-item">
                        <div class="pattern-value">${avgSum.toFixed(1)}</div>
                        <div>Trung b√¨nh s·ªë</div>
                    </div>
                    <div class="pattern-item">
                        <div class="pattern-value">${patterns.avgOddCount.toFixed(1)}</div>
                        <div>TB s·ªë l·∫ª</div>
                    </div>
                    <div class="pattern-item">
                        <div class="pattern-value">${patterns.avgSum.toFixed(0)}</div>
                        <div>TB t·ªïng</div>
                    </div>
                </div>
                <p style="margin-top: 15px; color: #666;"><strong>Kho·∫£ng th·ªùi gian:</strong> ${dateRange}</p>
            `;
        }

        function displayHotColdNumbers() {
            // L·∫•y to√†n b·ªô d·ªØ li·ªáu thay v√¨ ch·ªâ 30 ng√†y
            const allData = lotteryData;
            const frequency = {};
            
            for (let i = 1; i <= 45; i++) frequency[i] = 0;
            allData.forEach(draw => draw.numbers.forEach(num => frequency[num]++));
            
            const sorted = Object.entries(frequency).sort((a, b) => b[1] - a[1]);
            const hot = sorted.slice(0, 10);
            const cold = sorted.slice(-10).reverse();
            
            // Hot numbers
            const hotContainer = document.getElementById('hotNumbers');
            hotContainer.innerHTML = '';
            hot.forEach(([num, freq]) => {
                const ball = document.createElement('div');
                ball.className = 'mini-ball hot';
                ball.textContent = num;
                ball.title = `Xu·∫•t hi·ªán ${freq}/${lotteryData.length} l·∫ßn (${((freq/lotteryData.length)*100).toFixed(1)}%)`;
                hotContainer.appendChild(ball);
            });
            
            // Cold numbers
            const coldContainer = document.getElementById('coldNumbers');
            coldContainer.innerHTML = '';
            cold.forEach(([num, freq]) => {
                const ball = document.createElement('div');
                ball.className = 'mini-ball cold';
                ball.textContent = num;
                ball.title = `Xu·∫•t hi·ªán ${freq}/${lotteryData.length} l·∫ßn (${((freq/lotteryData.length)*100).toFixed(1)}%)`;
                coldContainer.appendChild(ball);
            });
        }

        function analyzePatterns() {
            let totalSum = 0;
            let totalOdd = 0;
            let totalConsecutive = 0;
            let totalInRange1_15 = 0;
            let totalInRange16_30 = 0;
            let totalInRange31_45 = 0;
            
            lotteryData.forEach(draw => {
                const numbers = draw.numbers;
                const sum = numbers.reduce((a, b) => a + b, 0);
                const oddCount = numbers.filter(n => n % 2 === 1).length;
                
                totalSum += sum;
                totalOdd += oddCount;
                
                // ƒê·∫øm s·ªë consecutive
                let consecutive = 0;
                for (let i = 0; i < numbers.length - 1; i++) {
                    if (numbers[i+1] === numbers[i] + 1) consecutive++;
                }
                totalConsecutive += consecutive;
                
                // ƒê·∫øm theo range
                totalInRange1_15 += numbers.filter(n => n >= 1 && n <= 15).length;
                totalInRange16_30 += numbers.filter(n => n >= 16 && n <= 30).length;
                totalInRange31_45 += numbers.filter(n => n >= 31 && n <= 45).length;
            });
            
            const count = lotteryData.length;
            return {
                avgSum: totalSum / count,
                avgOddCount: totalOdd / count,
                avgConsecutive: totalConsecutive / count,
                avgRange1_15: totalInRange1_15 / count,
                avgRange16_30: totalInRange16_30 / count,
                avgRange31_45: totalInRange31_45 / count
            };
        }

        function displayPatternAnalysis() {
            const patterns = analyzePatterns();
            const container = document.getElementById('patternAnalysis');
            
            container.innerHTML = `
                <div class="pattern-item">
                    <div class="pattern-value">${patterns.avgOddCount.toFixed(1)}</div>
                    <div>Trung b√¨nh s·ªë l·∫ª</div>
                </div>
                <div class="pattern-item">
                    <div class="pattern-value">${patterns.avgConsecutive.toFixed(1)}</div>
                    <div>Trung b√¨nh s·ªë li√™n ti·∫øp</div>
                </div>
                <div class="pattern-item">
                    <div class="pattern-value">${patterns.avgRange1_15.toFixed(1)}</div>
                    <div>Trung b√¨nh s·ªë (1-15)</div>
                </div>
                <div class="pattern-item">
                    <div class="pattern-value">${patterns.avgRange16_30.toFixed(1)}</div>
                    <div>Trung b√¨nh s·ªë (16-30)</div>
                </div>
                <div class="pattern-item">
                    <div class="pattern-value">${patterns.avgRange31_45.toFixed(1)}</div>
                    <div>Trung b√¨nh s·ªë (31-45)</div>
                </div>
                <div class="pattern-item">
                    <div class="pattern-value">${patterns.avgSum.toFixed(0)}</div>
                    <div>Trung b√¨nh t·ªïng c√°c s·ªë</div>
                </div>
            `;
        }

        function displayFrequencyChart() {
            const frequency = {};
            for (let i = 1; i <= 45; i++) frequency[i] = 0;
            
            lotteryData.forEach(draw => {
                draw.numbers.forEach(num => frequency[num]++);
            });
            
            const maxFreq = Math.max(...Object.values(frequency));
            const container = document.getElementById('frequencyChart');
            container.innerHTML = '';
            
            for (let i = 1; i <= 45; i++) {
                const bar = document.createElement('div');
                bar.className = 'bar';
                const height = (frequency[i] / maxFreq) * 180;
                bar.style.height = `${height}px`;
                bar.innerHTML = `<div class="bar-label">${i}</div>`;
                bar.title = `S·ªë ${i}: xu·∫•t hi·ªán ${frequency[i]} l·∫ßn`;
                container.appendChild(bar);
            }
        }

        function displayTrendAnalysis() {
            const container = document.getElementById('trendAnalysis');
            
            // Ph√¢n t√≠ch xu h∆∞·ªõng g·∫ßn ƒë√¢y
            const recent10 = lotteryData.slice(0, 10);
            const recent20 = lotteryData.slice(10, 20);
            
            const recentFreq = {};
            const olderFreq = {};
            
            for (let i = 1; i <= 45; i++) {
                recentFreq[i] = 0;
                olderFreq[i] = 0;
            }
            
            recent10.forEach(draw => draw.numbers.forEach(num => recentFreq[num]++));
            recent20.forEach(draw => draw.numbers.forEach(num => olderFreq[num]++));
            
            const trending = [];
            for (let i = 1; i <= 45; i++) {
                const trend = recentFreq[i] - olderFreq[i];
                if (trend > 0) trending.push({num: i, trend});
            }
            
            trending.sort((a, b) => b.trend - a.trend);
            const topTrending = trending.slice(0, 8);
            
            let trendHtml = '<h4 style="margin-bottom: 15px;">üìà S·ªë ƒëang trending:</h4><div class="number-list">';
            topTrending.forEach(item => {
                trendHtml += `<div class="mini-ball frequent" title="TƒÉng ${item.trend} l·∫ßn g·∫ßn ƒë√¢y">${item.num}</div>`;
            });
            trendHtml += '</div>';
            
            // Th√™m d·ª± ƒëo√°n ph·ª•
            trendHtml += `
                <h4 style="margin: 20px 0 15px 0;">üéØ C√°c b·ªô d·ª± ƒëo√°n kh√°c:</h4>
                <div id="alternativePredictions"></div>
            `;
            
            container.innerHTML = trendHtml;
            displayAlternativePredictions();
        }

        function displayAlternativePredictions() {
            const container = document.getElementById('alternativePredictions');
            const methods = [
                { name: 'üî• Theo t·∫ßn su·∫•t', numbers: predictByFrequency() },
                { name: 'üìà Theo xu h∆∞·ªõng', numbers: predictByTrend() },
                { name: 'üé≤ Theo pattern', numbers: predictByPattern() },
                { name: '‚è∞ Theo kho·∫£ng c√°ch', numbers: predictByGaps() }
            ];
            
            let html = '';
            methods.forEach(method => {
                html += `
                    <div style="margin-bottom: 15px;">
                        <strong>${method.name}:</strong>
                        <div class="number-list" style="margin-top: 5px;">
                `;
                method.numbers.forEach(num => {
                    html += `<div class="mini-ball" style="background: linear-gradient(135deg, #667eea, #764ba2);">${num}</div>`;
                });
                html += '</div></div>';
            });
            
            container.innerHTML = html;
        }

        function generateNewPrediction() {
            const btn = document.querySelector('.generate-btn');
            const loadingSpan = btn.querySelector('.loading');
            
            // Hi·ªÉn th·ªã loading
            loadingSpan.classList.remove('hidden');
            btn.disabled = true;
            btn.style.opacity = '0.7';
            
            setTimeout(() => {
                // T·∫°o d·ª± ƒëo√°n m·ªõi
                generatePredictions();
                
                // ·∫®n loading
                loadingSpan.classList.add('hidden');
                btn.disabled = false;
                btn.style.opacity = '1';
                
                // Hi·ªáu ·ª©ng bounce cho c√°c s·ªë m·ªõi
                const balls = document.querySelectorAll('#predictedNumbers .number-ball');
                balls.forEach((ball, index) => {
                    ball.style.animation = 'none';
                    setTimeout(() => {
                        ball.style.animation = `bounce 2s infinite`;
                        ball.style.animationDelay = `${index * 0.2}s`;
                    }, 50);
                });
                
                // C·∫≠p nh·∫≠t d·ª± ƒëo√°n ph·ª•
                displayAlternativePredictions();
                
                console.log('‚úÖ ƒê√£ t·∫°o d·ª± ƒëo√°n m·ªõi!');
            }, 1500);
        }

        // Auto-generate sample data for demo
        // (ƒê√£ lo·∫°i b·ªè v√¨ gi·ªù c√≥ auto-load CSV)
    </script>
</body>
</html>
